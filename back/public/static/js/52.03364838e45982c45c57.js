webpackJsonp([52],{"Q/ZQ":function(t,e,s){var a={"./views/login/auth":"U01x"};function r(t){return s(i(t))}function i(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(a)},r.resolve=i,t.exports=r,r.id="Q/ZQ"},U01x:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("3cXf"),r=s.n(a),i=s("4YfN"),o=s.n(i),n=s("mAm1"),c=s("NyFS"),l=s("oa6C"),u=s("SPhl"),m=s("sNOJ"),p=s("AL98"),f=s("9rMa"),d=(s("xSLg"),n.a,c.a,l.a,p.a,u.a,m.a,o()({},Object(f.b)(["setToken"]),{getAuth:function(t,e){var s=this;this.$http.post("/api/app.user/user/auth",{platform_id:t,security_params:e}).then(function(t){"0"==t.errcode?(s.loginstatus=t.data.loginstatus,s.jumpurl=t.data.jumpurl,s.platform_icon=t.data.platform_icon,s.platform_name=t.data.platform_name,s.site_icon=t.data.site_icon,s.site_name=t.data.site_name):s.$router.replace("/")}).catch(function(t){})},getCode:function(){var t=this;this.$refs.mobile.validate(),this.$refs.mobile.valid&&""!=this.form.mobile?this.$http.post("/api/app.util/sms/send",{mobile:this.form.mobile,type:0}).then(function(e){t.$vux.toast.text("发送成功"),t.$vux.toast.text(e.message),t.counttime(60)}).catch(function(e){t.$vux.toast.text(e.message),1e4==e.errcode&&(t.ifgetcode=!0,t.countimer=e.data.second,t.counttime(e.data.second))}):(this.$refs.mobile.forceShowError=!0,this.$vux.toast.text("请输入正确的手机号"))},login:function(){var t=this;if(1==this.loginstatus)location.href=this.jumpurl;else if(this.$refs.mobile.validate(),this.$refs.verifycode.validate(),this.$refs.mobile.valid&&this.$refs.verifycode.valid){var e=this.form;e.platform_id=this.platform_id,e.security_params=this.security_params,e.dologin=1,e.login_type=this.loginType,this.$http.post("/api/app.user/user/auth",e).then(function(e){"0"==e.errcode&&(t.setToken(e.data._user_token),localStorage.setItem("token",r()(e.data._user_token)),t.loginstatus=e.data.loginstatus,t.jumpurl=e.data.jumpurl,t.platform_icon=e.data.platform_icon,t.platform_name=e.data.platform_name,t.site_icon=e.data.site_icon,t.site_name=e.data.site_name,t.step=1,location.href=t.jumpurl)}).catch(function(e){"50001"==e.errcode?t.step=2:t.$vux.toast.text(e.message)})}else this.$refs.mobile.forceShowError=!0,this.$refs.verifycode.forceShowError=!0},register:function(){var t=this;this.$refs.username.validate(),this.$refs.password.validate(),this.$refs.check_password.validate(),this.$refs.username.valid&&this.$refs.password.valid&&this.$refs.check_password.valid?this.$http.post("/api/app.user/user/register",this.form).then(function(e){"0"==e.errcode&&(t.setToken(e.data._user_token),localStorage.setItem("token",r()(e.data._user_token)),t.step=1,t.getAuth(t.platform_id,t.security_params))}).catch(function(e){e.errcode&&t.$vux.toast.text(e.message),50010==e.errcode&&(t.step=1)}):(this.$refs.username.forceShowError=!0,this.$refs.password.forceShowError=!0,this.$refs.check_password.forceShowError=!0,this.form.check_password||(this.$refs.check_password.errors.equal="输入不一致",this.$refs.check_password.getError()))},loginForPwd:function(){var t=this;if(1==this.loginstatus)location.href=this.jumpurl;else if(this.$refs.username.validate(),this.$refs.password.validate(),this.$refs.username.valid&&this.$refs.password.valid){var e=this.form;e.platform_id=this.platform_id,e.security_params=this.security_params,e.dologin=1,e.login_type=this.loginType,this.$http.post("/api/app.user/user/auth",e).then(function(e){"0"==e.errcode&&(t.setToken(e.data._user_token),localStorage.setItem("token",r()(e.data._user_token)),t.loginstatus=e.data.loginstatus,t.jumpurl=e.data.jumpurl,t.platform_icon=e.data.platform_icon,t.platform_name=e.data.platform_name,t.site_icon=e.data.site_icon,t.site_name=e.data.site_name,t.step=1,location.href=t.jumpurl)}).catch(function(e){"50001"==e.errcode?t.$vux.toast.text("您还未注册，请使用短信登录完成注册"):t.$vux.toast.text(e.message)})}else this.$refs.username.forceShowError=!0,this.$refs.password.forceShowError=!0},backlogin:function(){this.step=1},toResetPwd:function(){this.$router.push({path:"/login/pwdreset"})},counttime:function(t){var e=this;this.wait||(this.countimer=t,this.ifgetcode=!0,this.wait=setInterval(function(){e.countimer>0&&e.countimer<=t?e.countimer--:(e.ifgetcode=!1,clearInterval(e.wait),e.wait=null)},1e3))},endtimer:function(){this.$vux.toast.text("请于倒计时结束后再获取验证码")},switchStatus:function(t){this.loginType=t}}),{components:{Flexbox:n.a,FlexboxItem:c.a,Divider:l.a,Drawer:p.a,Tab:u.a,TabItem:m.a},data:function(){return{step:1,countimer:"",ifgetcode:!1,wait:null,loginstatus:1,jumpurl:"",platform_name:"",platform_icon:"",site_name:"",site_icon:"",platform_id:"",security_params:"",form:{mobile:"",verifycode:"",username:"",password:"",check_password:""},loginType:"smsLogin"}},mounted:function(){this.security_params=this.$router.currentRoute.query._security_params,this.platform_id=this.$router.currentRoute.query._platform_id,this.security_params&&this.platform_id?this.getAuth(this.platform_id,this.security_params):this.$router.replace("/")},methods:o()({},Object(f.b)(["setToken"]),{getAuth:function(t,e){var s=this;this.$http.post("/api/app.user/user/auth",{platform_id:t,security_params:e}).then(function(t){"0"==t.errcode?(s.loginstatus=t.data.loginstatus,s.jumpurl=t.data.jumpurl,s.platform_icon=t.data.platform_icon,s.platform_name=t.data.platform_name,s.site_icon=t.data.site_icon,s.site_name=t.data.site_name):s.$router.replace("/")}).catch(function(t){})},getCode:function(){var t=this;this.$refs.mobile.validate(),this.$refs.mobile.valid&&""!=this.form.mobile?this.$http.post("/api/app.util/sms/send",{mobile:this.form.mobile,type:0}).then(function(e){t.$vux.toast.text("发送成功"),t.$vux.toast.text(e.message),t.counttime(60)}).catch(function(e){t.$vux.toast.text(e.message),1e4==e.errcode&&(t.ifgetcode=!0,t.countimer=e.data.second,t.counttime(e.data.second))}):(this.$refs.mobile.forceShowError=!0,this.$vux.toast.text("请输入正确的手机号"))},login:function(){var t=this;if(1==this.loginstatus)location.href=this.jumpurl;else if(this.$refs.mobile.validate(),this.$refs.verifycode.validate(),this.$refs.mobile.valid&&this.$refs.verifycode.valid){var e=this.form;e.platform_id=this.platform_id,e.security_params=this.security_params,e.dologin=1,e.login_type=this.loginType,this.$http.post("/api/app.user/user/auth",e).then(function(e){"0"==e.errcode&&(t.setToken(e.data._user_token),localStorage.setItem("token",r()(e.data._user_token)),t.loginstatus=e.data.loginstatus,t.jumpurl=e.data.jumpurl,t.platform_icon=e.data.platform_icon,t.platform_name=e.data.platform_name,t.site_icon=e.data.site_icon,t.site_name=e.data.site_name,t.step=1,location.href=t.jumpurl)}).catch(function(e){"50001"==e.errcode?t.step=2:t.$vux.toast.text(e.message)})}else this.$refs.mobile.forceShowError=!0,this.$refs.verifycode.forceShowError=!0},register:function(){var t=this;this.$refs.username.validate(),this.$refs.password.validate(),this.$refs.check_password.validate(),this.$refs.username.valid&&this.$refs.password.valid&&this.$refs.check_password.valid?this.$http.post("/api/app.user/user/register",this.form).then(function(e){"0"==e.errcode&&(t.setToken(e.data._user_token),localStorage.setItem("token",r()(e.data._user_token)),t.step=1,t.getAuth(t.platform_id,t.security_params))}).catch(function(e){e.errcode&&t.$vux.toast.text(e.message),50010==e.errcode&&(t.step=1)}):(this.$refs.username.forceShowError=!0,this.$refs.password.forceShowError=!0,this.$refs.check_password.forceShowError=!0,this.form.check_password||(this.$refs.check_password.errors.equal="输入不一致",this.$refs.check_password.getError()))},loginForPwd:function(){var t=this;if(1==this.loginstatus)location.href=this.jumpurl;else if(this.$refs.username.validate(),this.$refs.password.validate(),this.$refs.username.valid&&this.$refs.password.valid){var e=this.form;e.platform_id=this.platform_id,e.security_params=this.security_params,e.dologin=1,e.login_type=this.loginType,this.$http.post("/api/app.user/user/auth",e).then(function(e){"0"==e.errcode&&(t.setToken(e.data._user_token),localStorage.setItem("token",r()(e.data._user_token)),t.loginstatus=e.data.loginstatus,t.jumpurl=e.data.jumpurl,t.platform_icon=e.data.platform_icon,t.platform_name=e.data.platform_name,t.site_icon=e.data.site_icon,t.site_name=e.data.site_name,t.step=1,location.href=t.jumpurl)}).catch(function(e){"50001"==e.errcode?t.$vux.toast.text("您还未注册，请使用短信登录完成注册"):t.$vux.toast.text(e.message)})}else this.$refs.username.forceShowError=!0,this.$refs.password.forceShowError=!0},backlogin:function(){this.step=1},toResetPwd:function(){this.$router.push({path:"/login/pwdreset"})},counttime:function(t){var e=this;this.wait||(this.countimer=t,this.ifgetcode=!0,this.wait=setInterval(function(){e.countimer>0&&e.countimer<=t?e.countimer--:(e.ifgetcode=!1,clearInterval(e.wait),e.wait=null)},1e3))},endtimer:function(){this.$vux.toast.text("请于倒计时结束后再获取验证码")},switchStatus:function(t){this.loginType=t}})}),h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-login"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.site_name&&t.platform_name,expression:"site_name&&platform_name"}],staticClass:"auth_panel flex-box"},[a("div",{staticClass:"auth_item"},[a("img",{attrs:{src:t.site_icon}})]),t._v(" "),t._m(0),t._v(" "),a("div",{staticClass:"auth_item"},[a("img",{attrs:{src:t.platform_icon}})])]),t._v(" "),0==t.loginstatus?a("tab",{attrs:{"line-width":2,"custom-bar-width":"60px"}},[a("tab-item",{attrs:{selected:""},nativeOn:{click:function(e){t.switchStatus("smsLogin")}}},[t._v("短信登录")]),t._v(" "),a("tab-item",{nativeOn:{click:function(e){t.switchStatus("pwdLogin")}}},[t._v("密码登录")])],1):t._e(),t._v(" "),"smsLogin"==t.loginType?a("div",[1==t.step?a("div",{},[0==t.loginstatus?a("div",{staticClass:"clear"}):t._e(),t._v(" "),0==t.loginstatus?a("group",[a("x-input",{ref:"mobile",attrs:{title:"+86",name:"mobile",placeholder:"请输入手机号码",type:"number",keyboard:"number","is-type":"china-mobile",required:!0},model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}}),t._v(" "),a("x-input",{ref:"verifycode",staticClass:"weui-vcode",attrs:{placeholder:"请输入验证码",type:"number",keyboard:"number",min:6,required:!0},model:{value:t.form.verifycode,callback:function(e){t.$set(t.form,"verifycode",e)},expression:"form.verifycode"}},[t.ifgetcode?t._e():a("x-button",{attrs:{slot:"right",plain:"",type:"primary",mini:""},nativeOn:{click:function(e){t.getCode()}},slot:"right"},[t._v("发送验证码")]),t._v(" "),t.ifgetcode?a("x-button",{attrs:{slot:"right",plain:"",type:"primary",mini:""},nativeOn:{click:function(e){t.endtimer()}},slot:"right"},[t._v("重新发送"+t._s(t.countimer)+"s'")]):t._e()],1)],1):t._e(),t._v(" "),a("box",{attrs:{gap:"40px 10px"}},[a("x-button",{attrs:{type:"primary"},nativeOn:{click:function(e){t.login()}}},[t._v("授权登录")])],1)],1):t._e(),t._v(" "),2==t.step?a("div",{},[a("flexbox",{staticClass:"l-tit",attrs:{orient:"vertical",justify:"center"}},[a("div",{staticClass:"user-portrait"},[a("img",{attrs:{src:s("0gU3"),alt:""}})]),t._v(" "),a("div",{staticClass:"modeil"},[t._v(t._s(t.form.mobile))])]),t._v(" "),a("group",[a("x-input",{ref:"username",attrs:{title:"用户名",name:"username",placeholder:"请输入用户名",required:!0},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}}),t._v(" "),a("x-input",{ref:"password",attrs:{type:"password",title:"密码",name:"password",placeholder:"请输入密码",min:6,max:16,required:!0},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),t._v(" "),a("x-input",{ref:"check_password",attrs:{type:"password",title:"确认密码",name:"check_password",placeholder:"请输入确认密码",min:6,max:16,"equal-with":t.form.password,required:!0},model:{value:t.form.check_password,callback:function(e){t.$set(t.form,"check_password",e)},expression:"form.check_password"}}),t._v(" "),a("x-input",{attrs:{title:"邀请码",name:"invite_code",placeholder:"请输入邀请码（选填）"},model:{value:t.form.invite_code,callback:function(e){t.$set(t.form,"invite_code",e)},expression:"form.invite_code"}})],1),t._v(" "),a("box",{attrs:{gap:"30px 10px 20px"}},[a("x-button",{staticStyle:{"border-radius":"99px"},attrs:{type:"primary"},nativeOn:{click:function(e){t.register()}}},[t._v("注册并授权")])],1),t._v(" "),a("div",{staticClass:"backlogin",staticStyle:{"text-align":"center"},on:{click:function(e){t.backlogin()}}},[t._v("\r\n                返回登录页\r\n            ")])],1):t._e()]):t._e(),t._v(" "),"pwdLogin"==t.loginType?a("div",[a("div",{staticClass:"clear"}),t._v(" "),a("group",[a("x-input",{ref:"username",attrs:{name:"username",placeholder:"用户名/手机号",required:!0},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}}),t._v(" "),a("x-input",{ref:"password",attrs:{type:"password",name:"password",placeholder:"请输入密码",required:!0},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),t._v(" "),a("box",{attrs:{gap:"30px 10px 20px"}},[a("x-button",{attrs:{type:"primary"},nativeOn:{click:function(e){t.loginForPwd()}}},[t._v("授权登录")])],1),t._v(" "),a("div",{staticClass:"backlogin",staticStyle:{"text-align":"center"},on:{click:function(e){t.toResetPwd()}}},[t._v("\r\n            找回密码\r\n        ")])],1):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"auth_icon"},[e("i",{staticClass:"iconfont"},[this._v("")])])}]};var _=s("C7Lr")(d,h,!1,function(t){s("teTx")},null,null);e.default=_.exports},teTx:function(t,e){}});