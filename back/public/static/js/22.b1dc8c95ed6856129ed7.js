webpackJsonp([22],{"+fNY":function(t,e,i){var n={"./views/incharge/index":"4Zzq"};function s(t){return i(a(t))}function a(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}s.keys=function(){return Object.keys(n)},s.resolve=a,t.exports=s,s.id="+fNY"},"4Zzq":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("UTYE");var n=i("pWm4"),s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"withdraw-box"},[i("div",{staticClass:"head flex-box"},[i("div",{staticClass:"head-text flex-1"},[t._v(t._s(t.coin_type.coin_unit)+"兑换")])]),t._v(" "),i("div",{staticClass:"withdraw"},[i("div",{staticClass:"title"},[t._v("兑换数额")]),t._v(" "),i("div",{staticClass:"input-box flex-box vux-1px-b"},[i("x-input",{ref:"amount",staticClass:"flex-1",attrs:{type:"number","show-clear":!1,required:!0},on:{"on-change":function(e){t.sumFee()}},model:{value:t.amount,callback:function(e){t.amount=e},expression:"amount"}}),t._v(" "),i("span",[t._v(t._s(t.coin_type.coin_unit))])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:0==t.coin_type.id,expression:"coin_type.id==0"}],staticClass:"select-box"},[i("group",[i("popup-picker",{attrs:{title:"选择令牌",data:t.token_list,"show-name":"",columns:1},on:{"on-change":function(e){t.sumFee()}},model:{value:t.token_name,callback:function(e){t.token_name=e},expression:"token_name"}})],1)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:0==t.coin_type.id,expression:"coin_type.id==0"}],staticClass:"item-block"},[i("div",{staticClass:"item flex-box"},[i("div",{staticClass:"item-title flex-1"},[t._v("需要支付："+t._s(t.incharge_fee)+" "+t._s(t.token_symbol))])])])]),t._v(" "),i("div",{staticClass:"pupBox"},[i("div",{staticClass:"pupBox-content"},[i("div",{staticClass:"title"},[t._v("提示")]),t._v(" "),t._m(0),t._v(" "),i("box",{attrs:{gap:"2.1875rem 1.75rem 1.375rem"}},[i("x-button",{staticClass:"pup-btn",staticStyle:{"border-radius":"99px"},attrs:{type:"primary",link:"/wallet/create"}},[t._v("立即创建")])],1)],1)]),t._v(" "),i("box",{attrs:{gap:"40px 35px"}},[i("x-button",{staticClass:"pup-btn",staticStyle:{"border-radius":"99px"},attrs:{type:"primary"},nativeOn:{click:function(e){t.toPay()}}},[t._v("立即支付")])],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"pup-block"},[e("div",{staticClass:"item"},[this._v("您还未创建钱包，请先去创建")])])}]};var a=function(t){i("YIuA")},o=i("C7Lr")(n.a,s,!1,a,null,null);e.default=o.exports},UTYE:function(t,e,i){"use strict";(function(t){var e=i("Kw0a");i("l2dP"),i("xSLg"),e.a}).call(e,i("L7Pj"))},YIuA:function(t,e){},pWm4:function(t,e,i){"use strict";(function(t){var n=i("Kw0a"),s=i("l2dP"),a=i("xSLg");e.a={components:{PopupPicker:n.a},data:function(){return{coin_type:[],amount:"",token_list:[{name:"",value:"",address:"",rate:""}],token_name:[],token_symbol:"",address:"",rate:"",incharge_fee:0,platform_coin_price:0}},computed:{},created:function(){var t=Object(a.c)("setCoinInfo");t&&this.$store.dispatch("setCoinInfo",JSON.parse(t)),this.moneyInfo=this.$store.state.coin_info,this.moneyInfo.coin_type?this.coin_type=this.moneyInfo.coin_type:this.coin_type={id:0,coin_unit:this.$store.state.init.coin_uint}},mounted:function(){this.getWallets(),this.getInchargeToken(this.coin_type.id),this.$refs.amount.focus()},methods:{open_pup:function(){t(".pupBox").addClass("isopen")},getWallets:function(){var t=this;this.$http.post("/api/app.wallet/wallets",{}).then(function(e){""==e.data.wallets&&t.open_pup()}).catch(function(e){e.errcode&&t.$vux.toast.text(e.message)})},getInchargeToken:function(e){var i=this;this.$http.post("/api/app.util/init/incharge_token",{id:e}).then(function(e){var n=e.data.list,s=[];for(var a in n)n[a].token_symbol&&s.push({name:n[a].token_symbol,value:n[a].token_name,address:n[a].incharge_address,rate:n[a].incharge_rate});i.token_list=[s],i.token_name=[s[0].value],i.address=s[0].address,i.rate=s[0].rate,i.platform_coin_price=i.$store.state.init.coin_price,t(".input-box").find("input").focus()}).catch(function(t){t.errcode&&i.$vux.toast.text(t.message)})},sumFee:function(){if(0==this.coin_type.id&&this.amount>0){var t=this.token_list[0];for(var e in t)t[e].value==this.token_name[0]&&(this.token_symbol=t[e].name,this.address=t[e].address,this.rate=t[e].rate);this.incharge_fee=parseFloat(this.amount)/(this.rate/this.platform_coin_price)||0,this.incharge_fee=this.incharge_fee.toFixed(5),this.token_symbol==this.$store.state.init.coin_uint&&(this.incharge_fee=(this.incharge_fee/2).toFixed(5))}},toPay:function(){if(this.$refs.amount.validate(),this.$refs.amount.valid&&this.amount>0)if(0==this.coin_type.id)if(this.incharge_fee>0)if(this.token_symbol==this.$store.state.init.coin_uint){var t=this.token_name,e=this.incharge_fee;this.walletPay(t,e)}else this.assetPay();else this.$vux.toast.text("您输入的数额太少，无法兑换"),this.$refs.amount.forceShowError=!0;else{t=this.token_name,e=this.amount;this.walletPay(t,e)}else this.$vux.toast.text("数额必须大于0"),this.$refs.amount.forceShowError=!0},walletPay:function(t,e){var i=this,n=i.address;s.a.sendTransaction(t,n,e,function(){i.$router.push("/incharge")})},assetPay:function(){var t=this,e=t.token_symbol,i=t.incharge_fee,n=t.amount;this.$vux.confirm.show({title:"确认要兑换吗？",onCancel:function(){},onConfirm:function(){t.$http.post("/api/app.user/incharge",{incharge_amount:n,token_symbol:e,token_amount:i}).then(function(e){e.errcode>0?t.$vux.toast.text(e.message):(t.$vux.toast.text("兑换成功"),t.$router.push("/user/selfmoney"))}).catch(function(e){e.errcode&&t.$vux.toast.text(e.message)})}})}}}}).call(e,i("L7Pj"))}});