function toogle_sidebar_init(){if($(".toogle_sidebar").length>0){var t=$(".sidebar").offset().left,e=$(".toogle_sidebar").offset().left;$(".toogle_sidebar").bind("click",function(){"off"!=($(this).attr("status")?$(this).attr("status"):"")?($(".sidebar").hide(),$(".toogle_sidebar").css("left",t),$(".main-container").css("margin-left",t),$(this).attr("status","off")):($(".sidebar").show(),$(".toogle_sidebar").css("left",e),$(".main-container").css("margin-left",e),$(this).attr("status","on"))})}}function openUpdatePwd(t){$("#update_id").val(t),$("#updateModal").modal("show")}function updateAdminPwd(){$.ajax({url:"update_admin_pwd",type:"POST",dataType:"json",data:$("#updateForm").serialize(),success:function(t){0==t.errcode?($("#updateModal").modal("hide"),$("#successMsg").html(t.message),$("#successModal").modal("show")):($("#errorMsg").html(t.message),$("#errorModal").modal("show"))}})}function openSetAccess(t,e){$("#id").val(t),$("#role_key").val(e),$("#accessModal").modal("show")}function setAccess(){$.ajax({url:"set_admin_access",type:"POST",dataType:"json",data:$("#accessForm").serialize(),success:function(t){0==t.errcode?($("#accessModal").modal("hide"),$("#successMsg").html(t.message),$("#successModal").modal("show")):($("#errorMsg").html(t.message),$("#errorModal").modal("show"))}})}function openAddAdmin(){$("#addModal").modal("show")}function addAdmin(){$.ajax({url:"add_admin",type:"POST",dataType:"json",data:$("#addForm").serialize(),success:function(t){0==t.errcode?($("#addModal").modal("hide"),$("#successMsg").html(t.message),$("#successModal").modal("show")):($("#errorMsg").html(t.message),$("#errorModal").modal("show"))}})}function delAdmin(t){$.showConfirm("确定要删除该账号吗？",function(){$.ajax({url:"del_admin",type:"GET",dataType:"json",data:"&id="+t,success:function(t){0==t.errcode?($("#successMsg").html(t.message),$("#successModal").modal("show")):($("#errorMsg").html(t.message),$("#errorModal").modal("show"))}})})}function init_cropper_window(t,e,o,s,i){var a=$("#cropper_image");if(e>570){var n=o/e;e=570,o=570*n}else if(o>380){var n=e/o;o=380,e=380*n}if(e>570){var n=o/e;e=570,o=570*n}else if(o>380){var n=e/o;o=380,e=380*n}e=parseInt(e),o=parseInt(o),$("#cropperwindow .img-container").css("width",e),$("#cropperwindow .img-container").css("height",o);var r=200,d=200;"undefined"!=typeof init_width&&(r=init_width),"undefined"!=typeof init_height&&(d=init_height);var l={responsive:!1,minContainerWidth:e,minContainerHeight:o,minCanvasWidth:e,minCanvasHeight:o,resizable:!1,zoomable:!0,aspectRatio:1,width:r,height:d};l.aspectRatio=r/d,a.on().cropper(l),$("#setCroppedCanvas").click(function(){var e,o,s,n=$(this),l=n.data();if(!n.prop("disabled")&&!n.hasClass("disabled")&&a.data("cropper")&&l.method){if(l=$.extend({},l),void 0!==l.target&&(e=$(l.target),void 0===l.option))try{l.option=JSON.parse(e.val())}catch(t){console.log(t.message)}a.cropper(l.method,l.option,l.secondOption).toDataURL("image/png"),s=a.cropper("getData"),s.x=parseInt(s.x),s.y=parseInt(s.y),s.width=parseInt(s.width),s.height=parseInt(s.height);t.split(".");o=t+"?x-oss-process=image/crop,x_"+s.x+",y_"+s.y+",w_"+r+",h_"+d,i(o,s)}}),$("#cropperwindow").modal("show")}function dataURLtoBlob(t){for(var e=t.split(","),o=e[0].match(/:(.*?);/)[1],s=atob(e[1]),i=s.length,a=new Uint8Array(i);i--;)a[i]=s.charCodeAt(i);return new Blob([a],{type:o})}function getObjectURL(t){var e=null;return void 0!=window.createObjectURL?e=window.createObjectURL(t):void 0!=window.URL?e=window.URL.createObjectURL(t):void 0!=window.webkitURL&&(e=window.webkitURL.createObjectURL(t)),e}function random_string(t){t=t||32;var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=e.length,s="";for(i=0;i<t;i++)s+=e.charAt(Math.floor(Math.random()*o));return s}function get_suffix(t){return pos=t.lastIndexOf("."),suffix="",-1!=pos&&(suffix=t.substring(pos)),suffix}function XMLtoString(t){var e;try{serializer=new XMLSerializer,e=serializer.serializeToString(t)}catch(o){e=t.xml}return e}var messageModal='<div class="modal fade" tabindex="-1" role="dialog" ><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button><h4 class="modal-title"></h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal">确定</button></div></div></div></div>',confirmModal='<div class="modal fade" tabindex="-1" role="dialog" ><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button><h4 class="modal-title"></h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary confirm_btn">确定</button></div></div></div></div>';$.showErr=function(t,e){var o=$("#errbox");0==o.length&&(o=$(messageModal),$("body").append(o),$(o).attr("id","errbox"),$(o).find(".modal-title").html("错误")),$(o).find(".modal-body").html(t),$(o).unbind("hidden.bs.modal"),$(o).bind("hidden.bs.modal",e),$(o).modal({keyboard:!1})},$.showSuccess=function(t,e){var o=$("#successbox");0==o.length&&(o=$(messageModal),$("body").append(o),$(o).attr("id","successbox"),$(o).find(".modal-title").html("成功")),$(o).find(".modal-body").html(t),$(o).unbind("hidden.bs.modal"),$(o).bind("hidden.bs.modal",e),$(o).modal({keyboard:!1})},$.showConfirm=function(t,e,o){var s=$("#confirmbox");0==s.length&&(s=$(confirmModal),$("body").append(s),$(s).attr("id","confirmbox"),$(s).find(".modal-title").html("提示")),$(s).find(".modal-body").html(t),$(s).unbind("hidden.bs.modal"),$(s).bind("hidden.bs.modal",o),$(s).find(".confirm_btn").unbind("click"),$(s).find(".confirm_btn").bind("click",function(){$(s).unbind("hidden.bs.modal"),$(s).bind("hidden.bs.modal",e),$(s).modal("hide")}),$(s).modal({keyboard:!1})},toogle_sidebar_init();var rangeoptions={autoUpdateInput:!1,locale:{format:"YYYY-MM-DD",applyLabel:"确定",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}};$(".data_range_time").daterangepicker(rangeoptions,function(t,e,o){this.element.val(this.startDate.format(this.locale.format)+this.locale.separator+this.endDate.format(this.locale.format)),console.log(t.toISOString(),e.toISOString(),o)}),function(t){var e=function(e,o){this.$element=t(e),this.options=t.extend({},t.fn.autocomplete.defaults,o),this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=t(this.options.menu),this.shown=!1,this.formatItem=this.options.formatItem||this.formatItem,this.setValue=this.options.setValue||this.setValue,this.listen()};e.prototype={constructor:e,processObj:0,formatItem:function(t){return t.toString()},setValue:function(t){return{"data-value":t.toString(),"real-value":t.toString()}},select:function(){var t=this.$menu.find(".active").attr("data-value"),e=this.$menu.find(".active").attr("real-value");return this.$element.val(this.updater(t)).attr("real-value",e).change(),this.hide()},updater:function(t){return t},show:function(){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:e.top+e.height,left:e.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(e){var o;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(o=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,o?this.process(o):this)},process:function(t){return t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},highlighter:function(t){t=this.formatItem(t);var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(new RegExp("("+e+")","ig"),function(t,e){return'<strong style="color:#FF6600;">'+e+"</strong>"})},render:function(e){var o=this;return e=t(e).map(function(e,s){return e=t(o.options.item).attr(o.setValue(s)),e.find("a").html(o.highlighter(s)),e[0]}),e.first().addClass("active"),this.$menu.html(e),this},next:function(e){var o=this.$menu.find(".active").removeClass("active"),s=o.next();s.length||(s=t(this.$menu.find("li")[0])),s.addClass("active")},prev:function(t){var e=this.$menu.find(".active").removeClass("active"),o=e.prev();o.length||(o=this.$menu.find("li").last()),o.addClass("active")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(e){this.suppressKeyPressRepeat=~t.inArray(e.keyCode,[40,38,9,13,27]),this.move(e)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(t){switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:var e=this;e.processObj&&(clearTimeout(e.processObj),e.processObj=0),e.processObj=setTimeout(function(){e.lookup()},e.options.delay)}t.stopPropagation(),t.preventDefault()},focus:function(t){this.focused=!0},blur:function(t){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(t){t.stopPropagation(),t.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")},mouseleave:function(t){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var o=t.fn.autocomplete;t.fn.autocomplete=function(o){return this.each(function(){var s=t(this),i=s.data("autocomplete"),a="object"==typeof o&&o;i||s.data("autocomplete",i=new e(this,a)),"string"==typeof o&&i[o]()})},t.fn.autocomplete.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1,delay:500},t.fn.autocomplete.Constructor=e,t.fn.autocomplete.noConflict=function(){return t.fn.autocomplete=o,this},t(document).on("focus.autocomplete.data-api",'[data-provide="autocomplete"]',function(e){var o=t(this);o.data("autocomplete")||o.autocomplete(o.data())})}(window.jQuery);var cropperModal='<div class="modal fade" id="cropperwindow" tabindex="-1" role="dialog" ><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button><h4 class="modal-title">图片裁切</h4></div><div class="modal-body cropper-bg"><div class="img-container" style="margin:0 auto;"><img id="cropper_image" alt="Picture"></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary" id="setCroppedCanvas" data-method="getCroppedCanvas">确定</button></div></div></div></div>';$.cropperWindow=function(t,e,o,s,i){$("#cropperwindow").remove(),$("body").append(cropperModal);var a=$("#cropper_image"),n=t,t=function(t){var e="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+e}(t);if(a.attr("src",t),0==e&&0==o){var r=new Image;r.src=t,r.complete?(e=r.width,o=r.height,init_cropper_window(n,e,o,s,i)):r.onload=function(){e=r.width,o=r.height,init_cropper_window(n,e,o,s,i)}}else init_cropper_window(n,e,o,s,i)},$.fanwe_upload=function(t,e,o,s,i,a,n,r,d,l){s||(s="jpg,jpeg,png,gif"),i||(i=1),o||(o={}),a||(a=!1);var c=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:t,url:e,flash_swf_url:flash_swf_url,silverlight_xap_url:silverlight_xap_url,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},multipart_params:o,multi_selection:a,filters:{max_file_size:i+"mb",mime_types:[{title:"请选择文件",extensions:s}]},init:{FilesAdded:function(t,e){c.start(),$.loading(1,"上传中")},UploadProgress:function(t,e){n&&n(t,e)},FileUploaded:function(t,e,s){o=JSON.parse(s.response),o.errcode>0?($.loading(0),c.stop(),l&&l(t,o)):r&&r(t,e,s)},UploadComplete:function(t,e){$.loading(0),d&&d(t,e)},Error:function(t,e){if($.loading(0),l){var o={errcode:e.code,message:e.message};l(t,o)}}}});c.init()},$.fanwe_upload_cropper=function(t,e,o,s,i,a,n,r,d){$.fanwe_upload(t,e,o,s,i,!1,function(){},function(t,e,s){o=JSON.parse(s.response),o.errcode>0?($.loading(0),uploader.stop(),n&&n(t,o)):$.cropperWindow(o.data.src,o.data.width,o.data.height,"",function(t,e){s.data={},s.data.src=t,s.data.cropdata=e,layer.close(cropper_index),a&&a(s)},r,d)},function(t,e){},function(t,e){n&&n(t,e)})},$(function(){$.ajaxSetup({beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()},error:function(){$("#loading").hide()}}),$("#successModal").on("hide.bs.modal",function(){location.reload()}),$("#errorModal").on("show.bs.modal",function(){$(this).css("z-index",9999)})}),$(".form_ajaxsubmit").submit(function(){var t=$(this).attr("action"),e=$(this).serialize();return $.ajax({url:t,type:"POST",dataType:"json",data:e,success:function(t){if(0!=t.errcode)return $.showErr(t.message),!1;$.showSuccess(t.message,function(){null!=t.data.url?window.location.href=t.data.url:window.location.reload()})}}),!1});